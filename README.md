# analysis-doc
An analysis framework to create web documents

# Introduction

The use case that this framework was generated involves a data analysis situation in which there are several models, or primary reconstruction analyses of a data set, and, for each such "model", there are multiple views, which I'll call analyses.  The analysis code, typically producing figures and tables, is written as a Python class inheriting from a base class containg code to produce a web document.

The three components are then:

* a _dataset_, perhaps one of many
* a set of _models_ to represent the data in  the dataset. In my work, these are detailed fits to gamma-ray data. All models for a given dataset are in a folder, may contain a file “config.yaml” to specify parameters applying to all models. The files for each model are in subfolder, with the name of the model, which must contain a "config.yaml" configuration file, with parameters used to create the model, 
* A set of _analyses_ to make plots and summaries of each model. Each such produces an HTML document. An individual analysis is represented by a python module containing a class inheriting from AnalysisBase
Each analysis generates one or more plots, which correspond to functions in the class.

So there is a potential HTML document for each analysis, applied to each model. Creation of a document also generates an HTML index file.

## About this repository
The code and example here are a limited example of what I actually use, to demonstate the principle. The current code can be found
[here](https://github.com/tburnett/pointlike/tree/master/python/uw/like2/analyze), which includes many actual analysis classes specific to Fermi-LAT.

# Creation of models
This system assumes that each model has a corresponding folder, containing a file _config.yaml_ which defines paramters for the model; all are subfolders of a folder grouping them together, corresponding to the dataset. This folder may also have a _config.yaml_, containing definions of global parameters describing the dataset. Creation of the model folders is performed by reconstruction or pattern recognition code. This framework is to support summary analyses of the data generated by this step.

# Writing and running analysis code
An analysis is encapsulated by a Python class that inherits from a base class `AnalysisBase`, provided by this package. It must implement at least two methods, as well as one or more analysis functions:

* `setup`
This is called when the class is run. It must define `self.plotfolder` to be the name which will be used for the folder containing the output plots and documents. (There should not be an `__init__`.)

* `all_plots` 
This function has a statement like `self.runfigures([self.plot1, self.plot2,])`, where `plot1` and `plot2` are analysis functions, described next.

Sections of the resulting document are generated by analysis functions, which are member functions of the class. Each must contain a docstring, the first line of which will be used as a header for the section of the generated document. Remaining lines will appear in the body. If the text of the docstring contains `%(name)s`, the contents of
`self.name` will be included, allowing for insertion of any HTML generated at run time. The to_html() function for a pandas DataFrme is especially useful here. If the function generates a plot, it must return the matplotlib Figure object.

The class itself must have a docstring, which will be used to generate the heading for the document itself.
